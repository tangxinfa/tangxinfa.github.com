<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>linux - 看看俺 – KanKanAn.com</title>
        <description>记我所思，忆我所为。</description>
        <link>http://blog.kankanan.com/tag/linux.xml</link>
        <lastBuildDate>Tue, 23 Jun 2015 10:57:24 GMT</lastBuildDate>
        <docs>http://blogs.law.harvard.edu/tech/rss</docs>
        <image>
            <title>linux - 看看俺 – KanKanAn.com</title>
            <url>http://blog.kankanan.com/static/favicon.ico</url>
            <link>http://blog.kankanan.com/tag/linux.xml</link>
        </image>
        <copyright>版权所有 © 2011-2015 看看俺 – KanKanAn.com</copyright>
        <generator>Feed for Node.js</generator>
        <category>技术</category>
        <item>
            <title><![CDATA[linux非交互方式修改用户密码]]></title>
            <link>/article/linux-975e4ea44e9265b95f0f4fee6539752862375bc67801.html</link>
            <guid>/article/linux-975e4ea44e9265b95f0f4fee6539752862375bc67801.html</guid>
            <pubDate>Tue, 16 Jun 2015 09:35:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>
linux下的 <code>passwd</code> 命令是交互式运行的（密码需要由用户使用键盘输入），后台程序如果要改用户密码需要一定的技巧。
</p>

<p>
如：以下命令可以将 <code>root</code> 帐号的密码改为 <code>123456</code>
</p>

<div class="org-src-container">

<pre class="src src-sh">(<span style="color: #b294bb;">echo</span> <span style="color: #8abeb7;">'123456'</span>; sleep 1; <span style="color: #b294bb;">echo</span> <span style="color: #8abeb7;">'123456'</span>) | passwd <span style="color: #8abeb7;">'root'</span> &gt; /dev/null
</pre>
</div>

<p>
但是，此时也不好判断密码是否改成功了，需要验证一下。
</p>

<p>
参考文章《<a href="http://www.xinotes.net/notes/note/1833/">Check Linux user password in C</a> 》编写了以下程序用于非交互式修改密码：
</p>

<p>
<a href="../static/change_password.c">change_password.c</a>
</p>

<p>
编译：
</p>
<div class="org-src-container">

<pre class="src src-sh">gcc -g change_password.c -o change_password -lcrypt
</pre>
</div>

<p>
运行：
</p>
<div class="org-src-container">

<pre class="src src-sh">./change_password root 123456
</pre>
</div>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[linux下创建另一个root帐号]]></title>
            <link>/article/linux-4e0b521b5efa53e64e004e2a-root-5e1053f7.html</link>
            <guid>/article/linux-4e0b521b5efa53e64e004e2a-root-5e1053f7.html</guid>
            <pubDate>Thu, 04 Jun 2015 12:27:00 GMT</pubDate>
            <content:encoded><![CDATA[<div class="org-src-container">

<pre class="src src-sh">useradd -g 0 -u 0 -o root1
</pre>
</div>

<p>
上面的命令创建了一个和 <code>root</code> 帐号几乎一模一样的帐号 <code>root1</code> ，这个帐号登录后甚至连 <code>$USER</code> 环境变量都是 <code>root=， 应该是由于 =uid</code> 和 <code>root</code> 帐号一样都是 <code>0</code> ，所以使用了 <code>root</code> 帐号的用户名，但是可以指定不同的 <code>HOME</code> 以及密码等。</p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[FlashCache多盘方案实战]]></title>
            <link>/article/flashcache-591a76d865b968485b9e6218.html</link>
            <guid>/article/flashcache-591a76d865b968485b9e6218.html</guid>
            <pubDate>Wed, 29 Apr 2015 09:38:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>
目标系统为单SSD+多HDD，将多HDD创建为RAID5逻辑盘，然后使用FlashCache将SSD做为RAID5逻辑盘的缓存。
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">系统信息</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>OS

<p>
CentOS release 6.5 (Final) x86_64
</p>
</li>

<li>CPU

<p>
8
</p>

<p>
Intel(R) Atom(TM) CPU  C2750  @ 2.40GHz
</p>
</li>

<li>MEMORY

<p>
4
</p>

<p>
TOTAL 16G
</p>
</li>

<li>HDD

<p>
4
</p>

<p>
WDC WD4000FYYZ-0 4TB 7200转
</p>

<p>
/dev/sdc /dev/sdd /dev/sde /dev/sdf
</p>
</li>

<li>SSD

<p>
1
</p>

<p>
INTEL SSDSC2BB30 300GB
</p>

<p>
/dev/sdb
</p>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">卸载HDD及SSD盘</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">

<pre class="src src-sh">umount /dev/sdc /dev/sdd /dev/sde /dev/sdf /dev/sdb
</pre>
</div>

<p>
确保系统重启后不会自动挂载这些盘。
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">将多HDD创建为RAID5逻辑盘</h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>格式化HDD盘

<div class="org-src-container">

<pre class="src src-sh">parted /dev/sdc
(parted) mklabel gpt
(parted) unit TB
(parted) mkpart primary 0.00TB 4.00TB
(parted) print
</pre>
</div>

<p>
其它HDD盘也做如上处理.
</p>
</li>

<li>创建RAID5逻辑分区

<div class="org-src-container">

<pre class="src src-sh">mdadm --create /dev/md0 --level=raid5 --raid-devices=4 /dev/sd[c-f]1
parted /dev/md0
(parted) mklabel gpt
(parted) unit TB
(parted) mkpart primary 0.00TB 12.00TB
(parted) print
(parted) quit
</pre>
</div>
</li>

<li>保存RAID5配置

<div class="org-src-container">

<pre class="src src-sh">mdadm --detail --scan &gt; /etc/mdadm.conf
</pre>
</div>

<p>
参考：<a href="https://raid.wiki.kernel.org/index.php/RAID_setup#Saving_your_RAID_configuration">Saving your RAID configuration</a>
</p>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">安装Flashcache</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">

<pre class="src src-sh">wget https://github.com/facebook/flashcache/archive/stable_v3.1.3.zip -O flashca<span style="text-decoration: underline;">che_stable_v3.1.3.zip</span>
unzip flashcache_stable_v3.1.3.zip
<span style="color: #b294bb;">cd</span> flashcache-stable_v3.1.3
make
make install
modprobe flashcache
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">创建Flashcache混合设备</h2>
<div class="outline-text-2" id="text-5">
<div class="org-src-container">

<pre class="src src-sh">flashcache_create -p around cachedev /dev/sdb /dev/md0p1
mkfs.ext4 /dev/mapper/cachedev
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">挂载Flashcache混合设备</h2>
<div class="outline-text-2" id="text-6">
<div class="org-src-container">

<pre class="src src-sh">mkdir /data
mount /dev/mapper/cachedev /data
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">系统重启后需要重新创建并挂载Flashcache设备</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">

<pre class="src src-sh">flashcache_create -p around cachedev /dev/sdb /dev/md0p1
mount /dev/mapper/cachedev /data
</pre>
</div>

<p>
注意：使用除 <code>writethrough</code> 和 <code>writearound</code> 以外的模式需要使用 <code>flashcache_load</code> 重新创建设备。
</p>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8">写入速度测试</h2>
<div class="outline-text-2" id="text-8">
<p>
循环创建60MiB大小的文件，测得的磁盘写入速度为 <b>35.6MiB</b> ，磁盘读取速度为 <b>2.1MiB</b> 。
</p>
</div>
</div>

<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9">读取速度测试</h2>
<div class="outline-text-2" id="text-9">
<ul class="org-ul">
<li>500并发120G文件每次读取32KB顺序读取

<ul class="org-ul">
<li>请求处理速度

<p>
2107
</p>
</li>

<li>传输速度

<p>
132.35MiB/s
</p>
</li>
</ul>
</li>

<li>500并发500G文件每次读取32KB顺序读取

<ul class="org-ul">
<li>请求处理速度

<p>
1937
</p>
</li>

<li>传输速度

<p>
61.09MiB
</p>
</li>
</ul>
</li>

<li>500并发1T文件每次读取32KB顺序读取

<ul class="org-ul">
<li>请求处理速度

<p>
1574
</p>
</li>

<li>传输速度

<p>
49.64MiB/s
</p>
</li>
</ul>
</li>

<li>500并发120G文件每次读取64KB顺序读取

<ul class="org-ul">
<li>请求处理速度

<p>
5006
</p>
</li>

<li>传输速度

<p>
157.88MiB/s
</p>
</li>
</ul>
</li>

<li>500并发500G文件每次读取64KB顺序读取

<ul class="org-ul">
<li>请求处理速度

<p>
897
</p>
</li>

<li>传输速度

<p>
56.37MiB/s
</p>
</li>
</ul>
</li>

<li>500并发1T文件每次读取64KB顺序读取

<ul class="org-ul">
<li>请求处理速度

<p>
782
</p>
</li>

<li>传输速度

<p>
49.10MiB/s
</p>
</li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10">注意事项</h2>
<div class="outline-text-2" id="text-10">
<ul class="org-ul">
<li>重建（rebuild）

<p>
当一块盘坏掉后，如果配置了热备盘（Hot spare disk），会自动重建，请将坏盘换掉并配置成热备盘；\
如果未配置热备盘，读性能会下降（坏盘中的数据需要全部通过计算重现），请将坏盘换掉系统会自动进行重建。
</p>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11">潜在的优化选项</h2>
<div class="outline-text-2" id="text-11">
<ul class="org-ul">
<li>开启SSD写Cache
</li>

<li>禁用文件、目录访问时间戳

<p>
noatime,nodiratime
</p>
</li>

<li><code>Write-Back</code> 模式优化

<div class="org-src-container">

<pre class="src src-sh">sysctl -w dev.flashcache.sdb+md0p1.dirty_thresh_pct=80
</pre>
</div>
</li>
</ul>
</div>
</div>


<div id="outline-container-sec-12" class="outline-2">
<h2 id="sec-12">卸载Flashcache设备</h2>
<div class="outline-text-2" id="text-12">
<div class="org-src-container">

<pre class="src src-sh">umount /dev/mapper/cachedev
dmsetup remove cachedev
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-13" class="outline-2">
<h2 id="sec-13">Q&amp;A</h2>
<div class="outline-text-2" id="text-13">
<ul class="org-ul">
<li>重新调整 Flashcache 选项会不会删除数据？

<p>
<code>writethrough</code> 、 <code>writearound</code> 模式不会，其它的会。
</p>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-14" class="outline-2">
<h2 id="sec-14">相关参考</h2>
<div class="outline-text-2" id="text-14">
<dl class="org-dl">
<dt> 《<a href="http://lzw.me/a/linux-lvm.html">Linux LVM逻辑卷管理详细介绍</a>》 </dt><dd>非常好的LVM入门文章
</dd>

<dt> 《<a href="http://www.linux-mag.com/id/7582/">Pick Your Pleasure: RAID-0 mdadm Striping or LVM Striping?</a>》 </dt><dd>LVM与RAID-0的比较
</dd>

<dt> 《<a href="http://www.tecmint.com/create-raid0-in-linux/">Creating Software RAID0 (Stripe) on ‘Two Devices’ Using ‘mdadm’ Tool in Linux – Part 2</a>》 </dt><dd>构建RAID-0教程
</dd>

<dt> 《<a href="http://zengrong.net/post/2014.htm">在CentOS 6.1上配置 4TB硬盘+RAID1</a>》 </dt><dd>使用 <code>parted</code> 代替 <code>fdisk</code> 对大于2TB的硬盘进行分区
</dd>

<dt> 《<a href="http://wiki.mikejung.biz/Software_RAID">Software RAID - How to Optimize Software RAID on Linux using Mdadm</a>》 </dt><dd>优化RAID
</dd>

<dt> 《<a href="http://sysadmin.blog.51cto.com/83876/236802">RAID5单盘故障读写分析</a>》 </dt><dd>RAID5一块盘坏掉后的情形分析
</dd>
</dl>
</div>
</div>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[linux下通过HTTP同步系统时间]]></title>
            <link>/article/linux-4e0b901a8fc7-http-540c6b657cfb7edf65f695f4.html</link>
            <guid>/article/linux-4e0b901a8fc7-http-540c6b657cfb7edf65f695f4.html</guid>
            <pubDate>Tue, 21 Apr 2015 03:54:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>
在 <code>NTP</code> 被禁用的网络环境下，可以通过 <code>HTTP</code> 协议从公开的网站（如：www.baidu.com）同步时间，因为HTTP响应通常会带一个Date字段，这是WEB服务器的系统时间，可以用它来设置本机时间。
</p>

<div class="org-src-container">

<pre class="src src-sh">sudo date --rfc-2822 -s <span style="color: #8abeb7;">"`curl -s -i -X HEAD --header "Connection: close" http:/</span><span style="color: #8abeb7; text-decoration: underline;">/www.baidu.com | grep -E '^Date: ' | awk -F ': ' '{print $2}'`"</span>
</pre>
</div>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[在linux使用nfs挂载其它linux机器上的文件夹]]></title>
            <link>/article/5728-linux-4f7f7528-nfs-63028f7d51765b83-linux-673a56684e0a768465874ef65939.html</link>
            <guid>/article/5728-linux-4f7f7528-nfs-63028f7d51765b83-linux-673a56684e0a768465874ef65939.html</guid>
            <pubDate>Tue, 23 Sep 2014 08:52:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>
下面的IP地址以及工作目录需按实际情况进行修改。
</p>

<ul class="org-ul">
<li>在本地机器上允许目录被远程挂载

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #b294bb;">echo</span> <span style="color: #8abeb7;">'/home/tangxinfa/workdir *(rw,sync,no_root_squash)'</span> &gt;&gt; /etc/exports
sudo exportfs -arv
</pre>
</div>
</li>

<li>在远程机器上挂载本地机器上的文件夹

<div class="org-src-container">

<pre class="src src-sh">mkdir /tmp/Projects; mount -t nfs -o nolock 192.168.111.100:/home/tangxinfa/Proj<span style="text-decoration: underline;">ects /tmp/Projects</span>
</pre>
</div>
</li>
</ul>

<p>
问题诊断
</p>

<ul class="org-ul">
<li>mount: RPC: Unable to receive; errno = Connection refused

<p>
需要启动nfs-server服务：
</p>

<div class="org-src-container">

<pre class="src src-sh">sudo systemctl enable nfs-server.service
sudo systemctl start nfs-server.service
</pre>
</div>

<p>
另外，如果刚刚做了linux内核更新而没有重启系统也可能导致这个问题，重启一下再试。
</p>
</li>

<li>mount: 192.168.111.100:/home/tangxinfa/Projects failed, reason given by server: Permission denied

<p>
在/etc/exports文件中允许目录被远程挂载即可。</p>
</li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Thinkpad T540p修复linux下触摸板按下时光标位置移动问题]]></title>
            <link>/article/thinkpad-t540p-4fee590d-linux-4e0b89e66478677f63094e0b65f6514968074f4d7f6e79fb52a895ee9898.html</link>
            <guid>/article/thinkpad-t540p-4fee590d-linux-4e0b89e66478677f63094e0b65f6514968074f4d7f6e79fb52a895ee9898.html</guid>
            <pubDate>Mon, 22 Sep 2014 06:29:00 GMT</pubDate>
            <content:encoded><![CDATA[<ul class="org-ul">
<li>执行以下设置命令即可

<div class="org-src-container">

<pre class="src src-sh">synclient <span style="color: #f0c674;">HorizHysteresis</span>=30 <span style="color: #f0c674;">VertHysteresis</span>=30
</pre>
</div>

<p>
将上面的命令放到~/.xprofile中，以便重启后仍然生效。
</p>
</li>
</ul>

<p>
参考：<a href="https://blog.lnx.cx/2014/03/20/fedora-20-and-the-thinkpad-t440s-touchpad/">Fedora 20 and the ThinkPad T440s touchpad | Technitribe</a></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[linux下修改键位映射]]></title>
            <link>/article/linux-4e0b4fee6539952e4f4d66205c04.html</link>
            <guid>/article/linux-4e0b4fee6539952e4f4d66205c04.html</guid>
            <pubDate>Fri, 19 Sep 2014 06:07:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>
在linux下会大量使用ctrl和alt键，但是普通键盘上这两个键所在位置太偏，按起来非常吃力，交换键位可以很好的解决这个问题。
</p>

<ul class="org-ul">
<li>通过gnome-tweak-tool进行修改

<p>
Typing页可以完成常用的修改，如：交换Caps Lock和Ctrl，交换左Ctrl和Alt。但是在我的笔记本上设置好后有时候会失效.
</p>
</li>

<li>通过setxkbmap命令进行修改

<p>
Caps Lock改为Ctrl：setxkbmap -option ctrl:nocaps
</p>

<p>
可以查看/usr/share/X11/xkb/rules/evdev.lst查看支持的交换方式。Ctrl和Alt交换试了一下没有效果。
</p>

<p>
将setxkbmap设置命令放到~/.xprofile中即可开机生效。
</p>
</li>
</ul>


<ul class="org-ul">
<li>通过配置~/.Xmodmap进行修改

<p>
可以完成任意的键盘映射。
</p>

<p>
如下所示：Caps Lock改为Ctrl，左Ctrl改为Alt：
</p>

<pre class="example">
keycode 66 = Control_L
clear Lock
add control = Control_L

clear control
clear mod1
keycode 37 = Alt_L Meta_L
add control = Control_L Control_R
add mod1 = Alt_L Meta_L
</pre>

<p>
启用设置：
</p>

<div class="org-src-container">

<pre class="src src-sh">xmodmap ~/.Xmodmap
</pre>
</div>

<p>
在~/.xprofile中添加以上指令以便开机生效：
</p>

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #b5bd68;">if</span> [ -f $<span style="color: #f0c674;">HOME</span>/.Xmodmap ]; <span style="color: #b5bd68;">then</span>
<span style="background-color: #373b41;"> </span>   /usr/bin/xmodmap $<span style="color: #f0c674;">HOME</span>/.Xmodmap
<span style="color: #b5bd68;">fi</span>
</pre>
</div>

<p>
参考：
</p>

<ul class="org-ul">
<li><a href="http://earthviaradio.wordpress.com/2012/02/06/swapping-the-left-alt-and-ctrl-keys-in-ubuntu-11-10/">Swapping the left Alt and Ctrl keys in Ubuntu 11.10</a>
</li>

<li><a href="http://efod.se/writings/linuxbook/html/caps-lock-to-ctrl.html">Changing your caps lock into Ctrl in X</a>
</li>

<li><a href="https://wiki.archlinux.org/index.php/Xmodmap_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">Xmodmap (简体中文)</a>
</li>
</ul>
</li>

<li>清除xmodmap以及setxkbmap的配置

<div class="org-src-container">

<pre class="src src-sh">setxkbmap -layout us
</pre>
</div>
</li>

<li>换hhkb pro2键盘

<p>
linux用户必备，ctrl和alt键已经放置到最优位置，而且后面的跳线开关支持常用的键位交换，即使是linux文本模式下也可用。</p>
</li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[CentOS 6.4下安装redmine]]></title>
            <link>/article/centos-6.4-4e0b5b8988c5-redmine.html</link>
            <guid>/article/centos-6.4-4e0b5b8988c5-redmine.html</guid>
            <pubDate>Fri, 07 Mar 2014 06:17:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>
本文为CentOS 6.4下安装redmine-2.5.0的笔记，按照 <a href="http://www.redmine.org/projects/redmine/wiki/RedmineInstall">官方文档</a> 进行安装。
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">安装 <code>ruby</code></h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">

<pre class="src src-sh">yum install ruby
yum install ruby-devel
yum install rubygems
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">安装 <code>redmine</code></h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">

<pre class="src src-sh">wget <span style="color: #8abeb7;">'http://www.redmine.org/releases/redmine-2.5.0.tar.gz'</span>
tar xzvf redmine-2.5.0.tar.gz
gem install bundler
gem install mysql2.
yum install ImageMagick ImageMagick-devel
bundle install --without development test
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">配置 <code>redmine</code></h2>
<div class="outline-text-2" id="text-3">
<ul class="org-ul">
<li>以 root 用户登录 <code>mysql</code>

<div class="org-src-container">

<pre class="src src-sh">mysql -uroot -p
</pre>
</div>
</li>

<li>创建 <code>redmine</code> 用户及库

<div class="org-src-container">

<pre class="src src-sql"><span style="color: #b5bd68;">CREATE</span> DATABASE redmine <span style="color: #81a2be;">CHARACTER</span> <span style="color: #b5bd68;">SET</span> utf8;
<span style="color: #b5bd68;">CREATE</span> <span style="color: #b294bb;">USER</span> <span style="color: #8abeb7;">'redmine'</span>@<span style="color: #8abeb7;">'localhost'</span> IDENTIFIED <span style="color: #b5bd68;">BY</span> <span style="color: #8abeb7;">'redmine'</span>;
<span style="color: #b5bd68;">GRANT</span> <span style="color: #b5bd68;">ALL</span> <span style="color: #b5bd68;">PRIVILEGES</span> <span style="color: #b5bd68;">ON</span> redmine.* <span style="color: #b5bd68;">TO</span> <span style="color: #8abeb7;">'redmine'</span>@<span style="color: #8abeb7;">'localhost'</span>;
</pre>
</div>
</li>

<li>修改数据库配置文件

<div class="org-src-container">

<pre class="src src-sh">cp config/database.yml.example config/database.yml
diff config/database.yml config/database.yml.example
10,11c10,11
&lt;   username: redmine
&lt;   password: <span style="color: #8abeb7;">"redmine"</span>
---
&gt;   username: root
&gt;   password: <span style="color: #8abeb7;">""</span>
</pre>
</div>
</li>

<li>初始化会话存储

<div class="org-src-container">

<pre class="src src-sh">rake generate_secret_token
</pre>
</div>
</li>

<li>创建数据库表结构

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #f0c674;">RAILS_ENV</span>=production rake db:migrate
</pre>
</div>
</li>

<li>解决上一步可能出现的错误

<blockquote>
<p>
rake aborted!
Can't connect to local MySQL server through socket '/var/lib/mysql/mysql.sock' (2)
</p>

<p>
Tasks: TOP =&gt; db:migrate =&gt; environment
</p>
</blockquote>

<p>
确定 <code>mysql</code> 启动时指定的 <code>mysql.sock</code> 文件的路径
</p>

<div class="org-src-container">

<pre class="src src-sh">ps aux | grep mysql.sock
</pre>
</div>

<p>
显示的 <code>mysql.sock</code> 路径可能为“ <code>--socket=/tmp/mysql.sock</code> ”
</p>

<p>
修改 <code>redmine</code> 数据库配置，在 <code>production</code> 配置中添加 <code>socket</code> 项：
</p>

<pre class="example">
production:
  ...
  socket: /tmp/mysql.sock
</pre>

<p>
重新进行上一步操作。
</p>
</li>

<li>初始化数据

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #f0c674;">RAILS_ENV</span>=production <span style="color: #f0c674;">REDMINE_LANG</span>=zh rake redmine:load_default_data
</pre>
</div>
</li>

<li>创建相关目录

<div class="org-src-container">

<pre class="src src-sh">mkdir -p tmp tmp/pdf public/plugin_assets
sudo chown -R nobody:nobody files log tmp public/plugin_assets
sudo chmod -R 755 files log tmp public/plugin_assets
</pre>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">试运行 <code>redmine</code></h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">

<pre class="src src-sh">ruby script/rails server webrick -e production
</pre>
</div>

<ul class="org-ul">
<li>浏览器打开页面

<p>
<a href="http://localhost:3000">http://localhost:3000</a>
</p>

<p>
使用 用户名 <code>admin</code> ，密码 <code>admin</code> 登录后，立即修改密码。
</p>

<p>
使用下面的命令生成随机的密码：
</p>

<div class="org-src-container">

<pre class="src src-sh">cat /dev/urandom | head -1 | md5sum | head -c 8
</pre>
</div>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5">配置 <code>redmine</code></h2>
<div class="outline-text-2" id="text-5">
<ul class="org-ul">
<li>修改 <code>config/settings.yml</code>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6">使用 <code>Nginx</code> 和 <code>passenger</code></h2>
<div class="outline-text-2" id="text-6">
<div class="org-src-container">

<pre class="src src-sh">wget <span style="color: #8abeb7;">'http://nginx.org/download/nginx-1.4.6.tar.gz'</span>
tar xzvf nginx-1.4.6.tar.gz
gem install passenger
yum install pcre-devel
passenger-install-nginx-module
</pre>
</div>

<ul class="org-ul">
<li>交互式安装过程

<ul class="org-ul">
<li>Automatically download and install Nginx?

<p>
选 2. No: I want to customize my Nginx installation. (for advanced users)
</p>
</li>

<li>Where is your Nginx source code located?

<p>
填解压的 <code>nginx</code> 源码包路径
</p>
</li>

<li>Where do you want to install Nginx to?

<p>
填 <code>/usr/local/nginx</code>
</p>
</li>
</ul>
</li>

<li>修改 /usr/local/nginx/conf/nginx.conf

<p>
在最后的 <code>}</code> 前添加以下配置
</p>

<pre class="example">
include vhosts/*.conf;
</pre>
</li>

<li>添加站点配置文件 <code>/usr/local/nginx/conf/vhosts/redmine.conf</code>

<pre class="example">
server {
  listen  80;
  server_name &lt;域名&gt;;
  root &lt;redmine根目录&gt;/public;
  passenger_enabled on;
  client_max_body_size 10m; # Max attachemnt size
}
</pre>
</li>

<li>启动 <code>nginx</code>

<div class="org-src-container">

<pre class="src src-sh">/usr/local/nginx/sbin/nginx
</pre>
</div>
</li>

<li>现在可以正式访问站点了

<p>
<a href="http://">http://</a>&lt;域名&gt;
</p>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7">支持 <code>OpenID</code> 第三方帐号登录</h2>
<div class="outline-text-2" id="text-7">
<ul class="org-ul">
<li>安装 <code>openid</code> 库

<div class="org-src-container">

<pre class="src src-sh">gem install ruby-openid
</pre>
</div>
</li>

<li>使用 <code>admin</code> 帐号登录系统，在“管理 - 配置 - 认证”中勾选上“允许使用OpenID登录和注册”。 
</li>

<li>用户注册时“密码”可以省略， 填上 <code>OpenID URL</code> 即可。
</li>

<li>如何获得Google的OpenID URL？

<ul class="org-ul">
<li>先在 <code>Google</code> 的站点上登录
</li>
<li>打开 <a href="https://profiles.google.com">https://profiles.google.com</a> 后会跳转到类似这样（ <code>https://plus.google.com/000000000000000000000/posts</code> ）的网页
</li>
<li>你的 <code>OpenID URL</code> 为 <a href="http://profiles.google.com/000000000000000000000">http://profiles.google.com/000000000000000000000</a>
</li>
</ul>
<p>
上面的 <code>000000000000000000000</code> 可能为任意的数字串
</p>
</li>

<li>管理员确认注册后即可在登录界面上输入 <code>OpenID URL</code> 直接登录

<p>
一般浏览器的输入框是有记忆功能的，双击后会出现输入历史下拉列表，直接选择即可。
</p>
</li>

<li>安装插件简化 <code>OpenID</code> 登录

<ul class="org-ul">
<li><a href="https://github.com/jorgebg/redmine-openid-selector">https://github.com/jorgebg/redmine-openid-selector</a> （不推荐） 为原始分枝，在 <code>redmine-2.5.0</code> 下不能直接安装会导致站点登录界面出现404错误，解决方案在 <a href="http://www.redmine.org/boards/3/topics/34327?r=38778#message-38778">这里</a> ，简而言之就是把插件目录名中的 <code>-</code> 改为 <code>_</code> 。
</li>

<li><a href="https://github.com/computerminds/redmine_openid_selector">https://github.com/computerminds/redmine_openid_selector</a> （不推荐） 这个分枝安装后可用，但界面为英文（其实界面就一句英文）。
</li>

<li><a href="https://github.com/tangxinfa/redmine_openid_selector">https://github.com/tangxinfa/redmine_openid_selector</a> （推荐） 为支持中文我fork了上一个分枝。
</li>

<li>通用的插件安装过程：

<div class="org-src-container">

<pre class="src src-sh"><span style="color: #b294bb;">cd</span> plugins
git clone https://github.com/tangxinfa/redmine_openid_selector.git
rake redmine:plugins:migrate <span style="color: #f0c674;">RAILS_ENV</span>=production
touch tmp/restart.txt
</pre>
</div>
</li>

<li>通用的插件卸载过程：

<div class="org-src-container">

<pre class="src src-sh">rake redmine:plugins:migrate <span style="color: #f0c674;">NAME</span>=redmine-openid-selector <span style="color: #f0c674;">VERSION</span>=0 <span style="color: #f0c674;">RAILS_ENV</span>=pr<span style="text-decoration: underline;">oduction</span>
rm -rf plugins/redmine-openid-selector
touch tmp/restart.txt
</pre>
</div>
</li>
</ul>
<p>
现在在登录及注册页面直接点击第三方站点Logo即可。
</p>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8">样式美化</h2>
<div class="outline-text-2" id="text-8">
<div class="org-src-container">

<pre class="src src-sh">git clone git://github.com/pixel-cookers/redmine-theme.git public/themes/pixel-c<span style="text-decoration: underline;">ookers</span>
touch tmp/restart.txt
</pre>
</div>

<p>
现在可以使用 <code>admin</code> 登录后台，在“管理 - 配置 - 显示 - 主题”中启用主题 <code>Pixel-cookers</code> 。</p>
</div>
</div>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[linux下允许普通用户执行需要root权限的命令]]></title>
            <link>/article/linux-4e0b51418bb8666e901a752862376267884c97008981-root-674396507684547d4ee4.html</link>
            <guid>/article/linux-4e0b51418bb8666e901a752862376267884c97008981-root-674396507684547d4ee4.html</guid>
            <pubDate>Thu, 26 Dec 2013 07:44:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>
最典型的情况是要实现一个通过web界面重启系统的功能，通常为了安全会以非root用户身份（通常是nobody）运行服务端脚本，这样脚本中就不能执行危险操作了。
</p>

<p>
下面的c工具程序可以允许任意用户执行需要root权限的命令：
</p>

<p>
[[<a href="../static/as_root.c][as_root.c">../static/as_root.c][as_root.c</a>]
</p>

<p>
编译：
</p>
<div class="org-src-container">

<pre class="src src-sh">gcc -g as_root.c -o as_root
</pre>
</div>

<p>
配置：
</p>
<div class="org-src-container">

<pre class="src src-sh">chown root:root ./as_root; chmod 4755 ./as_root
</pre>
</div>

<p>
运行：
</p>
<div class="org-src-container">

<pre class="src src-sh">sudo -u <span style="color: #8abeb7;">"nobody"</span> ./as_root <span style="color: #8abeb7;">"reboot"</span>
</pre>
</div>

<p>
参考：<a href="http://blog.tianya.cn/blogger/post_show.asp?BlogID=126326&PostID=1629441">如何在普通用户下执行一些需要root用户执行的命令</a></p>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[linux下翻墙访问bitbucket.org仓库]]></title>
            <link>/article/linux-4e0b7ffb58998bbf95ee-bitbucket.org-4ed35e93.html</link>
            <guid>/article/linux-4e0b7ffb58998bbf95ee-bitbucket.org-4ed35e93.html</guid>
            <pubDate>Fri, 28 Jun 2013 05:57:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>
今天往bitbucket.org push时才发现bitbucket被GFW了。我的仓库为Mercurial hg，hg项目根目录下的 <code>.hg/hgrc</code> 配置文件中可指定http_proxy，试了一下不支持socks代理（我的浏览器用它来翻墙），最终使用tsocks软件实现翻墙访问bitbucket.org仓库。
</p>

<ul class="org-ul">
<li>利用vps建本地socks代理的脚本 <code>ssh_proxy.sh</code>
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #969896; font-style: italic;">#</span><span style="color: #969896; font-style: italic;">!/bin/</span><span style="color: #b5bd68;">bash</span>

<span style="color: #f0c674;">n</span>=<span style="color: #b294bb;">`ps waux | grep 'bash .*/ssh_proxy.sh' | grep -v grep | wc -l`</span>
<span style="color: #b5bd68;">if</span> [ $<span style="color: #f0c674;">n</span> -lt 3 ]; <span style="color: #b5bd68;">then</span>
<span style="background-color: #373b41;"> </span>   <span style="color: #b5bd68;">while</span> [ true ]; <span style="color: #b5bd68;">do</span>
<span style="background-color: #373b41;"> </span>   <span style="background-color: #373b41;"> </span>   <span style="color: #f0c674;">n</span>=<span style="color: #b294bb;">`ps aux | grep 'ssh' | grep '7070' | grep -v grep | wc -l`</span>
<span style="background-color: #373b41;"> </span>   <span style="background-color: #373b41;"> </span>   <span style="color: #b5bd68;">if</span> [ $<span style="color: #f0c674;">n</span> -lt 1 ]; <span style="color: #b5bd68;">then</span>
<span style="background-color: #373b41;"> </span>   <span style="background-color: #373b41;"> </span>   <span style="background-color: #373b41;"> </span>   <span style="color: #b294bb;">echo</span> <span style="color: #8abeb7;">"start ssh connecting"</span>
<span style="background-color: #373b41;"> </span>   <span style="background-color: #373b41;"> </span>   <span style="background-color: #373b41;"> </span>   ssh -qTnNf -D 7070 user@host
<span style="background-color: #373b41;"> </span>   <span style="background-color: #373b41;"> </span>   <span style="color: #b5bd68;">fi</span>
<span style="background-color: #373b41;"> </span>   <span style="background-color: #373b41;"> </span>   <span style="color: #b294bb;">echo</span> <span style="color: #8abeb7;">"wait for next checking"</span>
<span style="background-color: #373b41;"> </span>   <span style="background-color: #373b41;"> </span>   sleep 30
<span style="background-color: #373b41;"> </span>   <span style="color: #b5bd68;">done</span>
<span style="color: #b5bd68;">fi</span>
<span style="color: #b294bb;">echo</span> <span style="color: #8abeb7;">"ssh_proxy.sh already running"</span>
</pre>
</div>

<p>
请将user@host改为你的vps用户及主机，并配置为免输入密码。
</p>
</li>

<li>启动socks代理脚本

<div class="org-src-container">

<pre class="src src-sh">nohup bash ./ssh_proxy.sh &amp;
</pre>
</div>

<p>
浏览器也可以利用它来翻墙。
</p>
</li>

<li>安装tsocks
<div class="org-src-container">

<pre class="src src-sh">yaourt -S tsocks
</pre>
</div>
</li>

<li>配置tsocks

<p>
<code>/etc/tsocks.conf</code>
</p>
<pre class="example">
# We can access 192.168.0.* directly
local = 192.168.0.0/255.255.255.0
local = 10.0.0.0/255.0.0.0

# Otherwise we use the server
server = 127.0.0.1
server_port = 7070
</pre>
<p>
具体用法 <code>man tsocks.conf</code>
</p>
</li>

<li>使用tsocks让hg用上socks代理功能
<div class="org-src-container">

<pre class="src src-sh">tsocks hg push
</pre>
</div>
<p>
tsocks看起来很通用，应该也可以让git等进行socks代理访问。</p>
</li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[linux下跨进程传递文件描述符]]></title>
            <link>/article/linux-4e0b8de88fdb7a0b4f20901265874ef663cf8ff07b26.html</link>
            <guid>/article/linux-4e0b8de88fdb7a0b4f20901265874ef663cf8ff07b26.html</guid>
            <pubDate>Sat, 09 Mar 2013 07:11:00 GMT</pubDate>
            <content:encoded><![CDATA[
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">问题</h2>
<div class="outline-text-2" id="text-1">
<p>
在web开发中，以典型的php-fpm为例，对于到外部系统的连接（如：mysql、redis）等都提供了持久连接接口（pconnect），但是受限于多进程模型，事实上是每个php-fpm进程都有单独的一个连接池的（参见：《<a href="http:5f53-php-90474e0a-redis.html">当php遇上redis</a>》），大量空闲连接的存在不仅对系统资源造成了浪费（不单指fd空间，像mysql的每连接一线程会附带大量内存空间：sort_buffer、read_buffer等），而且整个系统将无法横向扩展（如：mysql连接数限制）。如果可以在进程间共享文件描述符，将可以大大提升系统性能，促进多进程模型的应用。
</p>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">方案</h2>
<div class="outline-text-2" id="text-2">
<p>
在linux平台下，sendmsg、recvmsg可以将一个进程的文件描述符传递给另一进程使用，这使得实现系统级的连接池成为可能。
</p>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">实现</h2>
<div class="outline-text-2" id="text-3">
<p>
《The Linux Programming Interface》61.13.3 Passing File Descriptors
</p>
</div>
</div>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[搭建jabber服务器]]></title>
            <link>/article/642d5efa-jabber-670d52a15668.html</link>
            <guid>/article/642d5efa-jabber-670d52a15668.html</guid>
            <pubDate>Tue, 03 May 2011 16:32:00 GMT</pubDate>
            <content:encoded><![CDATA[<ul class="org-ul">
<li>编译安装

<p>
<code>下载</code>
</p>
<div class="org-src-container">

<pre class="src src-sh">wget http://download.jabberd.org/jabberd14/jabberd14-1.6.1.1.tar.gz
tar xzvf jabberd14-1.6.1.1.tar.gz
<span style="color: #b294bb;">cd</span> jabberd14-1.6.1.1
</pre>
</div>

<p>
<code>修改代码以解决编译错误</code>
</p>
<div class="org-src-container">

<pre class="src src-sh">diff -r jabberd14-1.6.1.1/jabberd/lib/xmlnode.cc tmp/jabberd14-1.6.1.1/jabberd/l<span style="text-decoration: underline;">ib/xmlnode.cc</span>
882,884c882,884
&lt;     const char *next_step = NULL;
&lt;     const char *start_predicate = NULL;
&lt;     const char *end_predicate = NULL;
---
&gt;     char *next_step = NULL;
&gt;     char *start_predicate = NULL;
&gt;     char *end_predicate = NULL;
1836c1836
&lt;         ((char*)strchr(lang, <span style="color: #8abeb7;">'-'</span>))[0] = 0;
---
&gt;         strchr(lang, <span style="color: #8abeb7;">'-'</span>)[0] = 0;
diff -r jabberd14-1.6.1.1/jabberd/log.cc tmp/jabberd14-1.6.1.1/jabberd/log.cc
89c89
&lt;         pos = (char*)strchr(zone,<span style="color: #8abeb7;">'.'</span>);
---
&gt;     pos = strchr(zone,<span style="color: #8abeb7;">'.'</span>);
diff -r jabberd14-1.6.1.1/jabberd/mio_tls.cc tmp/jabberd14-1.6.1.1/jabberd/mio_t<span style="text-decoration: underline;">ls.cc</span>
615c615
&lt;         ret = gnutls_certificate_set_openpgp_key_file(current_credentials, pub<span style="text-decoration: underline;">file, privfile, GNUTLS_OPENPGP_FMT_BASE64);</span>
---
&gt;         ret = gnutls_certificate_set_openpgp_key_file(current_credentials, pub<span style="text-decoration: underline;">file, privfile);</span>
634c634
&lt;         ret = gnutls_certificate_set_openpgp_keyring_file(current_credentials,<span style="text-decoration: underline;"> file, GNUTLS_OPENPGP_FMT_BASE64);</span>
---
&gt;         ret = gnutls_certificate_set_openpgp_keyring_file(current_credentials,<span style="text-decoration: underline;"> file);</span>
640a641,657
&gt;     }
&gt;
&gt;     // load GnuPG trustdb
&gt;     if (j_strcmp(xmlnode_get_localname(cur), <span style="color: #8abeb7;">"trustdb"</span>) == 0) {
&gt;         char const *const file = xmlnode_get_data(cur);
&gt;
&gt;         if (file == NULL) {
&gt;         log_warn(NULL, <span style="color: #8abeb7;">"Initializing TLS subsystem: &lt;trustdb/&gt; element inside </span><span style="color: #8abeb7; text-decoration: underline;">the TLS configuration, that does not contain a file-name."</span><span style="text-decoration: underline;">);</span>
&gt;         continue;
&gt;         }
&gt;
&gt;         // load the GnuPG trustdb
&gt;         ret = gnutls_certificate_set_openpgp_trustdb(current_credentials, file<span style="text-decoration: underline;">);</span>
&gt;         if (ret &lt; 0) {
&gt;         log_error(NULL, <span style="color: #8abeb7;">"Error loading GnuPG trustdb %s: %s"</span>, file, gnutls_str<span style="text-decoration: underline;">error(ret));</span>
&gt;         continue;
&gt;         }
</pre>
</div>

<p>
<code>编译安装</code>
</p>
<div class="org-src-container">

<pre class="src src-sh">./configure &amp;&amp; make &amp;&amp; sudo make install
</pre>
</div>

<p>
如出错通常是少了相关依赖库，用包管理工具（如：ubuntu下的新立得）安装即可。
</p>
</li>

<li>配置

<p>
按照mysql.sql中的注释配置数据库：
</p>

<div class="org-src-container">

<pre class="src src-sh">mysql -uroot -p
mysql&gt; CREATE DATABASE jabber CHARACTER SET utf8;
mysql&gt; use jabber;
mysql&gt; grant all on jabber.* to jabber@localhost identified by <span style="color: #8abeb7;">'secret'</span>;
mysql&gt; <span style="color: #8abeb7;">\.</span> mysql.sql
</pre>
</div>
</li>

<li>运行

<div class="org-src-container">

<pre class="src src-sh">sudo jabberd -h localhost -B
</pre>
</div>
</li>

<li>注册用户1

<div class="org-src-container">

<pre class="src src-sh">telnet localhost 5222
&lt;stream:stream
<span style="background-color: #373b41;"> </span> <span style="color: #f0c674;">to</span>=<span style="color: #8abeb7;">'localhost'</span>
<span style="background-color: #373b41;"> </span> <span style="color: #f0c674;">xmlns</span>=<span style="color: #8abeb7;">'jabber:client'</span>
<span style="background-color: #373b41;"> </span> xmlns:<span style="color: #f0c674;">stream</span>=<span style="color: #8abeb7;">'http://etherx.jabber.org/streams'</span>&gt;

&lt;iq <span style="color: #f0c674;">id</span>=<span style="color: #8abeb7;">'reg1'</span> <span style="color: #f0c674;">type</span>=<span style="color: #8abeb7;">'set'</span>&gt;
<span style="background-color: #373b41;"> </span> &lt;query <span style="color: #f0c674;">xmlns</span>=<span style="color: #8abeb7;">'jabber:iq:register'</span>&gt;
<span style="background-color: #373b41;"> </span>   &lt;username&gt;jack&lt;/username&gt;
<span style="background-color: #373b41;"> </span>   &lt;password&gt;jack&lt;/password&gt;
<span style="background-color: #373b41;"> </span>   &lt;name&gt;jack&lt;/name&gt;
<span style="background-color: #373b41;"> </span>   &lt;email&gt;&lt;/email&gt;
<span style="background-color: #373b41;"> </span> &lt;/query&gt;
&lt;/iq&gt;

&lt;/stream:stream&gt;
</pre>
</div>
</li>

<li>登录用户1

<pre class="example">
Empathy菜单-&gt;编辑-&gt;帐户-&gt;添加：
协议: Jabber
登录ID: jack@localhost
记住密码
密码: jack
登录
</pre>
</li>

<li>注册用户2

<div class="org-src-container">

<pre class="src src-sh">telnet localhost 5222
&lt;stream:stream
<span style="background-color: #373b41;"> </span> <span style="color: #f0c674;">to</span>=<span style="color: #8abeb7;">'localhost'</span>
<span style="background-color: #373b41;"> </span> <span style="color: #f0c674;">xmlns</span>=<span style="color: #8abeb7;">'jabber:client'</span>
<span style="background-color: #373b41;"> </span> xmlns:<span style="color: #f0c674;">stream</span>=<span style="color: #8abeb7;">'http://etherx.jabber.org/streams'</span>&gt;

&lt;iq <span style="color: #f0c674;">id</span>=<span style="color: #8abeb7;">'reg1'</span> <span style="color: #f0c674;">type</span>=<span style="color: #8abeb7;">'set'</span>&gt;
<span style="background-color: #373b41;"> </span> &lt;query <span style="color: #f0c674;">xmlns</span>=<span style="color: #8abeb7;">'jabber:iq:register'</span>&gt;
<span style="background-color: #373b41;"> </span>   &lt;username&gt;rose&lt;/username&gt;
<span style="background-color: #373b41;"> </span>   &lt;password&gt;rose&lt;/password&gt;
<span style="background-color: #373b41;"> </span>   &lt;name&gt;rose&lt;/name&gt;
<span style="background-color: #373b41;"> </span>   &lt;email&gt;&lt;/email&gt;
<span style="background-color: #373b41;"> </span> &lt;/query&gt;
&lt;/iq&gt;

&lt;/stream:stream&gt;
</pre>
</div>
</li>

<li>用户1加用户2为联系人

<pre class="example">
Empathy菜单-&gt;聊天-&gt;添加联系人:
帐户：jack@localhost
标识符: rose@localhost
添加
</pre>
</li>

<li>登录用户2，并发一个消息给用户1

<div class="org-src-container">

<pre class="src src-sh">telnet localhost 5222
&lt;stream:stream
<span style="background-color: #373b41;"> </span> <span style="color: #f0c674;">to</span>=<span style="color: #8abeb7;">'localhost'</span>
<span style="background-color: #373b41;"> </span> <span style="color: #f0c674;">xmlns</span>=<span style="color: #8abeb7;">'jabber:client'</span>
<span style="background-color: #373b41;"> </span> xmlns:<span style="color: #f0c674;">stream</span>=<span style="color: #8abeb7;">'http://etherx.jabber.org/streams'</span>&gt;

&lt;iq <span style="color: #f0c674;">id</span>=<span style="color: #8abeb7;">'auth1'</span> <span style="color: #f0c674;">type</span>=<span style="color: #8abeb7;">'set'</span>&gt;
<span style="background-color: #373b41;"> </span> &lt;query <span style="color: #f0c674;">xmlns</span>=<span style="color: #8abeb7;">'jabber:iq:auth'</span>&gt;
<span style="background-color: #373b41;"> </span>   &lt;username&gt;rose&lt;/username&gt;
<span style="background-color: #373b41;"> </span>   &lt;password&gt;rose&lt;/password&gt;
<span style="background-color: #373b41;"> </span>   &lt;resource&gt;test&lt;/resource&gt;
<span style="background-color: #373b41;"> </span> &lt;/query&gt;
&lt;/iq&gt;

&lt;presence/&gt;

&lt;message <span style="color: #f0c674;">to</span>=<span style="color: #8abeb7;">'jack@localhost'</span>&gt;
<span style="background-color: #373b41;"> </span> &lt;body&gt;hello, jack&lt;/body&gt;
&lt;/message&gt;

&lt;/stream:stream&gt;
</pre>
</div>
</li>
</ul>
]]></content:encoded>
        </item>
    </channel>
</rss>