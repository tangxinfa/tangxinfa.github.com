<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0" xmlns:content="http://purl.org/rss/1.0/modules/content/">
    <channel>
        <title>archlinux - 看看俺 – KanKanAn.com</title>
        <description>记我所思，忆我所为。</description>
        <link>http://blog.kankanan.com/tag/archlinux.xml</link>
        <lastBuildDate>Mon, 31 Aug 2015 07:59:33 GMT</lastBuildDate>
        <docs>http://blogs.law.harvard.edu/tech/rss</docs>
        <image>
            <title>archlinux - 看看俺 – KanKanAn.com</title>
            <url>http://blog.kankanan.com/static/favicon.ico</url>
            <link>http://blog.kankanan.com/tag/archlinux.xml</link>
        </image>
        <copyright>版权所有 © 2011-2015 看看俺 – KanKanAn.com</copyright>
        <generator>Feed for Node.js</generator>
        <category>技术</category>
        <item>
            <title><![CDATA[在Archlinux上使用FlashCache]]></title>
            <link>/article/5728-archlinux-4e0a4f7f7528-flashcache.html</link>
            <guid>/article/5728-archlinux-4e0a4f7f7528-flashcache.html</guid>
            <pubDate>Thu, 23 Apr 2015 12:16:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>
<a href="https://github.com/facebook/flashcache/">Flashcache</a> 是 <a href="https://www.facebook.com">Facebook</a> 的一个开源项目，通过将固态硬盘（SSD）做为机械硬盘（HDD）的缓存层，提升磁盘I/O性能。
</p>

<p>
<a href="https://github.com/facebook/flashcache/">Flashcache</a> 位于磁盘驱动层与文件系统层之间，是一个 <code>linux</code> 内核模块。
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">编译安装</h2>
<div class="outline-text-2" id="text-1">
<p>
由于Archlinux总是使用最新的linux内核，最好从最新的 <a href="https://github.com/facebook/flashcache/">Flashcache</a> 源代码进行编译安装。
</p>

<div class="org-src-container">

<pre class="src src-sh">git clone https://github.com/facebook/flashcache.git
<span style="color: #cc99cc;">cd</span> flashcache
make
sudo make install
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">挂载模块</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">

<pre class="src src-sh">sudo insmod /lib/modules/<span style="color: #cc99cc;">`uname -r`</span>/extra/flashcache/flashcache.ko
</pre>
</div>

<ul class="org-ul">
<li>修复挂载错误

<blockquote>
<p>
insmod: ERROR: could not insert module /lib/modules/3.19.3-3-ARCH/extra/flashcache/flashcache.ko: Unknown symbol in module
</p>
</blockquote>

<p>
通过 <code>dmesg | grep flashcache</code> 可以看到以下错误信息：
</p>

<blockquote>
<p>
[ 2130.514615] flashcache: Unknown symbol dm_put_device (err 0)<br  />
       [ 2130.514654] flashcache: Unknown symbol dm_io_client_create (err 0)<br  />
       [ 2130.514693] flashcache: Unknown symbol dm_kcopyd_client_create (err 0)<br  />
       [ 2130.514738] flashcache: Unknown symbol dm_unregister_target (err 0)<br  />
       [ 2130.514774] flashcache: Unknown symbol dm_io_client_destroy (err 0)<br  />
       [ 2130.514798] flashcache: Unknown symbol dm_kcopyd_copy (err 0)<br  />
       [ 2130.514821] flashcache: Unknown symbol dm_register_target (err 0)<br  />
       [ 2130.514846] flashcache: Unknown symbol dm_kcopyd_client_destroy (err 0)<br  />
       [ 2130.514870] flashcache: Unknown symbol dm_table_get_mode (err 0)<br  />
       [ 2130.514895] flashcache: Unknown symbol dm_io (err 0)<br  />
       [ 2130.514915] flashcache: Unknown symbol dm_get_device (err 0)
</p>
</blockquote>

<p>
先挂载 <code>dm-mod</code> 模块再挂载 <code>flashcache</code> 模块即可：
</p>

<div class="org-src-container">

<pre class="src src-sh">sudo modprobe dm-mod
sudo insmod /lib/modules/<span style="color: #cc99cc;">`uname -r`</span>/extra/flashcache/flashcache.ko
</pre>
</div>

<p>
参考：<a href="https://bbs.archlinux.org/viewtopic.php?id=30478">No entry for device-mapper found</a>
</p>
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">模拟实验</h2>
<div class="outline-text-2" id="text-3">
<p>
参考：<a href="http://my.oschina.net/renguijiayi/blog/303747">flashcache的实现与用法</a>
</p>

<ul class="org-ul">
<li>创建SSD模拟设备

<p>
使用内存文件模拟块设备（1G）
</p>

<div class="org-src-container">

<pre class="src src-sh">dd <span style="color: #ffcc66;">if</span>=/dev/zero <span style="color: #ffcc66;">of</span>=/dev/shm/ssd.img <span style="color: #ffcc66;">bs</span>=1024k <span style="color: #ffcc66;">count</span>=1024
sudo losetup /dev/loop1 /dev/shm/ssd.img
</pre>
</div>
</li>

<li>创建HDD模拟设备

<p>
使用普通磁盘文件模拟块设备（5G）
</p>

<div class="org-src-container">

<pre class="src src-sh">sudo dd <span style="color: #ffcc66;">if</span>=/dev/zero <span style="color: #ffcc66;">of</span>=/hdd.img <span style="color: #ffcc66;">bs</span>=1024k <span style="color: #ffcc66;">count</span>=5120
sudo losetup /dev/loop2 /hdd.img
</pre>
</div>
</li>

<li>创建Flashcache混合设备

<div class="org-src-container">

<pre class="src src-sh">sudo flashcache_create -p around cachedev /dev/loop1 /dev/loop2
sudo mkfs.ext4 /dev/mapper/cachedev
</pre>
</div>
</li>

<li>挂载Flashcache混合设备

<div class="org-src-container">

<pre class="src src-sh">sudo mkdir /data
sudo mount /dev/mapper/cachedev /data
</pre>
</div>
</li>
</ul>

<p>
/data目录下的数据读写就已经在使用Flashcache了。
</p>

<ul class="org-ul">
<li>创建用来测试的数据文件（1G）

<div class="org-src-container">

<pre class="src src-sh">dd <span style="color: #ffcc66;">if</span>=/dev/urandom <span style="color: #ffcc66;">of</span>=/dev/shm/test.dat <span style="color: #ffcc66;">bs</span>=1024k <span style="color: #ffcc66;">count</span>=1024
</pre>
</div>
</li>

<li>测算使用HDD写耗时

<div class="org-src-container">

<pre class="src src-sh">sudo sh -c <span style="color: #66cccc;">'echo 1 &gt; /proc/sys/vm/drop_caches; time cp /dev/shm/test.dat /'</span>
</pre>
</div>

<p>
输出：
</p>

<pre class="example">
real    0m4.751s
user    0m0.000s
sys 0m0.600s
</pre>
</li>

<li>测算使用HDD读耗时

<div class="org-src-container">

<pre class="src src-sh">sudo sh -c <span style="color: #66cccc;">'echo 1 &gt; /proc/sys/vm/drop_caches; time cp /test.dat /dev/shm/</span>
</pre>
</div>

<p>
输出：
</p>

<pre class="example">
real    0m10.580s
user    0m0.010s
sys 0m0.727s
</pre>
</li>

<li>测算使用Flashcache写耗时

<div class="org-src-container">

<pre class="src src-sh">sudo sh -c <span style="color: #66cccc;">'echo 1 &gt; /proc/sys/vm/drop_caches; time cp /dev/shm/test.dat /data/'</span>
</pre>
</div>

<p>
输出：
</p>

<pre class="example">
real    0m7.363s
user    0m0.000s
sys 0m0.760s
</pre>
</li>

<li>测算使用Flashcache读耗时

<p>
第一轮测试（缓存预热）
</p>

<div class="org-src-container">

<pre class="src src-sh">sudo sh -c <span style="color: #66cccc;">'echo 1 &gt; /proc/sys/vm/drop_caches; time cp /data/test.dat /dev/shm/'</span>
</pre>
</div>

<p>
输出：
</p>

<pre class="example">
real    0m9.557s
user    0m0.013s
sys 0m1.157s
</pre>

<p>
第二轮测试（缓存生效）
</p>

<div class="org-src-container">

<pre class="src src-sh">sudo sh -c <span style="color: #66cccc;">'echo 1 &gt; /proc/sys/vm/drop_caches; time cp /data/test.dat /dev/shm/'</span>
</pre>
</div>

<p>
输出：
</p>

<pre class="example">
real    0m3.107s
user    0m0.000s
sys 0m0.850s
</pre>
</li>

<li>清除测试数据

<div class="org-src-container">

<pre class="src src-sh">sudo rm /test.dat /dev/shm/test.dat /data/test.dat
</pre>
</div>
</li>

<li>结果分析

<ul class="org-ul">
<li>Flashcache读性能： <b>提升70%</b>
</li>

<li>Flashcache写性能： <b>降低55%</b>
</li>
</ul>
<p>
因为使用了 <code>Write-Around</code> 方式，所以提升了读性能，降低了写性能。
</p>
</li>

<li>清除模拟环境

<div class="org-src-container">

<pre class="src src-sh">sudo umount /data
sudo dmsetup remove cachedev
sudo losetup -d /dev/loop1
sudo rm /dev/shm/ssd.img
sudo losetup -d /dev/loop2
sudo rm /hdd.img
sudo rmdir /data
</pre>
</div>
</li>
</ul>
</div>
</div>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Archlinux安装文本语音合成（TTS）]]></title>
            <link>/article/archlinux-5b8988c56587672c8bed97f354086210ff08-tts-ff09.html</link>
            <guid>/article/archlinux-5b8988c56587672c8bed97f354086210ff08-tts-ff09.html</guid>
            <pubDate>Wed, 15 Apr 2015 12:21:00 GMT</pubDate>
            <content:encoded><![CDATA[
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">安装 <code>festival</code></h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">

<pre class="src src-sh">yaourt -S festival festival-english festival-us
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">测试运行</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">

<pre class="src src-sh"><span style="color: #cc99cc;">echo</span> <span style="color: #66cccc;">"This is an example. Arch is the best."</span> | festival --tts
</pre>
</div>

<ul class="org-ul">
<li>修复错误 <code>Linux: can't open /dev/dsp</code>
</li>
</ul>

<p>
参考 <a href="https://wiki.archlinux.org/index.php/Festival#Can.27t_open_.2Fdev.2Fdsp">这里</a> 将以下内容添加到 <code>~/.festivalrc</code>
</p>

<div class="org-src-container">

<pre class="src src-lisp">(Parameter.set 'Audio_Method 'Audio_Command)
(Parameter.set 'Audio_Command <span style="color: #66cccc;">"aplay -q -c 1 -t raw -f s16 -r $SR $FILE"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">参考</h2>
<div class="outline-text-2" id="text-3">
<p>
<a href="https://wiki.archlinux.org/index.php/Festival">https://wiki.archlinux.org/index.php/Festival</a>
</p>

<p>
<a href="https://linuxtoy.org/archives/festival_on_ubuntu.html">https://linuxtoy.org/archives/festival_on_ubuntu.html</a></p>
</div>
</div>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Archlinux网络接口上出现两个IP]]></title>
            <link>/article/archlinux-7f517edc63a553e34e0a51fa73b04e244e2a-ip.html</link>
            <guid>/article/archlinux-7f517edc63a553e34e0a51fa73b04e244e2a-ip.html</guid>
            <pubDate>Wed, 12 Mar 2014 03:32:00 GMT</pubDate>
            <content:encoded><![CDATA[<ul class="org-ul">
<li>发现两个IP

<p>
我的电脑是直接连到公司的墙上的网口上网的，在测试路由器的时候，我把路由器的WAN口接墙上的网口，然后电脑连到路由器的LAN口上，上网正常。查看分配到的IP为192.168.111.2，路由器的IP为192.168.111.1， 想到我一直用 <code>192.168.90.73</code> 这个IP，有些配置也依赖这个IP，所以还想分到这个IP，所以把路由器的DHCP做了设置，路由器IP改为192.168.90.74，分配的IP范围为192.168.90.71-192.168.90.73，再次重连电脑分配的IP为192.168.90.71，然后发现上不了网了，浏览器上输入路由器的IP（192.168.90.74）竟然打开了我机器（192.168.90.71）上建的WEB服务，其他人连这个网络却可以通过192.168.90.74这个IP正常打开路由器界面，最终通过“ip address show”这个命令发现我的网口上有两个IP（192.168.90.71、192.168.90.74）， <code>ipconfig</code> 和其它GUI工具只能看到第一个IP。
</p>
</li>

<li>第二个IP是怎么来的？

<p>
抓包分析了一下DHCP网络包，只给分配了192.168.90.71这个IP，看来192.168.90.74这个IP是我机器上配置的，于是搜索/etc、/var下的文件，最后在/var/log/journal/*/system.journal中找到了日志：
</p>

<pre class="example">
NetworkManager[375]: &lt;debug&gt; [1394509845.924245] [nm-system.c:280] sync_addresses(): (eno1): adding address '192.168.90.74/24'
</pre>

<p>
然后在NetworkManager的配置文件 <code>/etc/NetworkManager/system-connections/Profile 1</code> 中找到了相关配置：
</p>

<pre class="example">
[ipv4]
method=auto
address1=192.168.90.74/24,192.168.90.2
</pre>

<p>
删除掉 <code>address1</code> 后，再重连网络，就只有一个IP了。
</p>

<p>
这应该是 <code>NetworkManager</code> 的一个 <a href="https://bugs.archlinux.org/task/41395">BUG</a> ，当手动设置IP后切回DHCP自动获取IP方式时不清除手动设置的时会出现。</p>
</li>
</ul>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Archlinux下解决更新grub后无法进入gnome3桌面的问题]]></title>
            <link>/article/archlinux-4e0b89e351b366f465b0-grub-540e65e06cd58fdb5165-gnome3-684c9762768495ee9898.html</link>
            <guid>/article/archlinux-4e0b89e351b366f465b0-grub-540e65e06cd58fdb5165-gnome3-684c9762768495ee9898.html</guid>
            <pubDate>Wed, 26 Jun 2013 02:07:00 GMT</pubDate>
            <content:encoded><![CDATA[<p>
在启动界面上会看到以下错误日志：
</p>
<pre class="example">
kernel: [    8.398186] [drm:radeon_init] *ERROR* No UMS support in radeon module!
</pre>

<p>
这个是由于grub配置文件中指定了内核参数 <code>nomodeset</code> 导致，linux的默认配置是为了运行服务器，以减少启动过程中出错的可能性，使用gnome3桌面时，需去掉内核参数 <code>nomodeset</code> ，以下为<a href="https://wiki.archlinux.org/index.php/ATI#Disable_KMS">原文</a>：
</p>

<pre class="example">
Note: Adding nomodeset to the kernel boot line might prevent GNOME 3's gnome-shell or KDE's desktop effects from running.
</pre>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Archlinux下安装cups打印系统]]></title>
            <link>/article/archlinux-4e0b5b8988c5-cups-625353707cfb7edf.html</link>
            <guid>/article/archlinux-4e0b5b8988c5-cups-625353707cfb7edf.html</guid>
            <pubDate>Wed, 27 Mar 2013 13:56:00 GMT</pubDate>
            <content:encoded><![CDATA[<dl class="org-dl">
<dt> 安装 </dt><dd></dd>
</dl>
<div class="org-src-container">

<pre class="src src-sh">yaourt -S cups-pdf
</pre>
</div>

<dl class="org-dl">
<dt> 启动 </dt><dd></dd>
</dl>
<div class="org-src-container">

<pre class="src src-sh">sudo systemctl start cups
</pre>
</div>

<dl class="org-dl">
<dt> 配置 </dt><dd>    参考：<a href="https://wiki.archlinux.org/index.php/Cups#PDF_virtual_printer">https://wiki.archlinux.org/index.php/Cups#PDF_virtual_printer</a>

<p>
登录的用户名要为root，否则后面还是无法添加打印机，web界面没有退出登录的选项，可以试试重启cups服务浏览器清除缓存的数据。</p>
</dd>
</dl>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[Archlinux下安装fcitx输入法]]></title>
            <link>/article/archlinux-4e0b5b8988c5-fcitx-8f9351656cd5.html</link>
            <guid>/article/archlinux-4e0b5b8988c5-fcitx-8f9351656cd5.html</guid>
            <pubDate>Sat, 15 Dec 2012 13:56:00 GMT</pubDate>
            <content:encoded><![CDATA[
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">安装</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">

<pre class="src src-sh">sudo yaourt -S fcitx-im
ln -s /etc/xdg/autostart/fcitx-autostart.desktop  ~/.config/autostart/
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">配置</h2>
<div class="outline-text-2" id="text-2">
<p>
在配置文件~/.xprofile中添加以下内容：
</p>
<pre class="example">
export GTK_IM_MODULE=fcitx
export QT_IM_MODULE=fcitx
export XMODIFIERS="@im=fcitx"
export LC_CTYPE="zh_CN.UTF-8"
</pre>

<p>
因为用的是gnome3桌面，需要禁用ibus：
</p>
<pre class="example">
gsettings set org.gnome.settings-daemon.plugins.keyboard active false
</pre>
<p>
还需要在键盘快捷键设置界面中将输入源切换的快捷键清除。
</p>
</div>
</div>
]]></content:encoded>
        </item>
        <item>
            <title><![CDATA[解决Archlinux下ati显卡3D硬件加速失效的问题]]></title>
            <link>/article/89e351b3-archlinux-4e0b-ati-663e5361-3d-786c4ef652a0901f59316548768495ee9898.html</link>
            <guid>/article/89e351b3-archlinux-4e0b-ati-663e5361-3d-786c4ef652a0901f59316548768495ee9898.html</guid>
            <pubDate>Wed, 05 Sep 2012 15:52:00 GMT</pubDate>
            <content:encoded><![CDATA[
<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1">问题描述</h2>
<div class="outline-text-2" id="text-1">
<ul class="org-ul">
<li>症状

<p>
进入gnome3桌面环境后很卡，不动还好，一动gnome-shell进程cpu占用就直奔100%。
</p>
</li>

<li>dmesg异常日志
<pre class="example">
radeon_cp: Failed to load firmware "radeon/R520_cp.bin"
radeon 0000:01:00.0: failed initializing CP (-2).
radeon 0000:01:00.0: Disabling GPU acceleration
</pre>
</li>
</ul>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2">解决办法</h2>
<div class="outline-text-2" id="text-2">
<div class="org-src-container">

<pre class="src src-sh">sudo ln -s /usr/lib/firmware /lib/
sudo reboot
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3">经验总结</h2>
<div class="outline-text-2" id="text-3">
<p>
出现问题时网上不一定能找到你要的答案，像这个问题，网上的论坛里有无数个建议，一个一个试下去其实很浪费时间，
试几次之后还没能解决就应该尝试主动分析解决，像这里稍微留意到括号里的-2，就能发现其实它是个错误码，
perror一下就知道意思是“找不到文件或目录”，联想到最近几次升级archlinux在把/lib里的东西往/usr/lib下移，
其中就包括firemware，这样手工在旧的firmware位置建一个软链接就解决了这个问题。
</p>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4">备注</h2>
<div class="outline-text-2" id="text-4">
<p>
这个问题应该是由于之前glibc升级时未全部完成引起的，archlinux现在把/lib改为/usr/lib的软链接了，可以手工进行设置为软链接这一步骤来修复。</p>
</div>
</div>
]]></content:encoded>
        </item>
    </channel>
</rss>